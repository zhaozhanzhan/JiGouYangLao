<ng-template #titleArea>
    <div>
        <p><span>消费登记详情</span></p>
    </div>
</ng-template>
<ng-template #basicInfoBtn>
    <button nz-button nzType="default" class="mr20" (click)="back()">返回</button>
</ng-template>
<nz-card [nzTitle]="titleArea" [nzExtra]="basicInfoBtn">
    <nz-card nzType="inner" nzTitle="基本信息">
        <div nz-row [nzGutter]="24">
            <div nz-col [nzSpan]="12">
                <nz-form-item>
                    <nz-form-label [nzSpan]="8">姓名</nz-form-label>
                    <nz-form-control [nzSpan]="16">
                        <input nz-input [(ngModel)]="oldManObjInfo.name" readonly (click)="openOldMan()" />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="12">
                <nz-form-item>
                    <nz-form-label [nzSpan]="8">性别</nz-form-label>
                    <nz-form-control [nzSpan]="16">
                        <input nz-input [(ngModel)]="oldManObjInfo.sex" readonly />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="12">
                <nz-form-item>
                    <nz-form-label [nzSpan]="8">年龄</nz-form-label>
                    <nz-form-control [nzSpan]="16">
                        <input nz-input [(ngModel)]="oldManObjInfo.age" readonly />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="12">
                <nz-form-item>
                    <nz-form-label [nzSpan]="8">身份证号</nz-form-label>
                    <nz-form-control [nzSpan]="16">
                        <input nz-input [(ngModel)]="oldManObjInfo.cardno" readonly />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="12">
                <nz-form-item>
                    <nz-form-label [nzSpan]="8">房间号</nz-form-label>
                    <nz-form-control [nzSpan]="16">
                        <input nz-input [(ngModel)]="oldManObjInfo.roomName" readonly />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="12">
                <nz-form-item>
                    <nz-form-label [nzSpan]="8">入院日期</nz-form-label>
                    <nz-form-control [nzSpan]="16">
                        <input nz-input [(ngModel)]="oldManObjInfo.inDate" readonly />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="12">
                <nz-form-item>
                    <nz-form-label [nzSpan]="8">累计住院天数</nz-form-label>
                    <nz-form-control [nzSpan]="16">
                        <input nz-input [(ngModel)]="oldManObjInfo.days" readonly />
                    </nz-form-control>
                </nz-form-item>
            </div>
        </div>
    </nz-card>
    <nz-card nzType="inner" nzTitle="账目信息" style="margin-top:10px">
        <div nz-row style="margin-top: 20px;" *ngFor="let item of accountList">
            <div nz-col nzSpan="8" style="border-bottom: 1px solid;padding-bottom: 10px;">缴存账目：{{item?.depositAccounts?.accountsName}}</div>
            <div nz-col nzSpan="8" style="border-bottom: 1px solid;padding-bottom: 10px;">账目余额：{{item?.accountBalance}} 元</div>
            <div nz-col nzSpan="8" style="border-bottom: 1px solid;padding-bottom: 10px;">账目累计缴存：{{item?.accountTotal}} 元</div>
        </div>
    </nz-card>
    <nz-card nzType="inner" nzTitle="消费信息" style="margin-top:10px">
        <div nz-row [nzGutter]="24">
            <div nz-col [nzSpan]="12">
                <nz-form-item>
                    <nz-form-label [nzSpan]="8">消费类别</nz-form-label>
                    <nz-form-control [nzSpan]="16">
                        <input nz-input [(ngModel)]="saveObj.expCategoryId" readonly />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="12">
                <nz-form-item>
                    <nz-form-label [nzSpan]="8">消费项目</nz-form-label>
                    <nz-form-control [nzSpan]="16">
                        <input nz-input [(ngModel)]="saveObj.expItemId" readonly />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="12">
                <nz-form-item>
                    <nz-form-label [nzSpan]="8">消费日期</nz-form-label>
                    <nz-form-control [nzSpan]="16">
                        <input nz-input [(ngModel)]="saveObj.consumptionTime" readonly />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="12">
                <nz-form-item>
                    <nz-form-label [nzSpan]="8">收费方式</nz-form-label>
                    <nz-form-control [nzSpan]="16">
                        <input nz-input [(ngModel)]="saveObj.chargeMode" readonly />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="12" *ngIf="saveObj.chargeMode=='代扣'">
                <nz-form-item>
                    <nz-form-label [nzSpan]="8">扣款账目</nz-form-label>
                    <nz-form-control [nzSpan]="16">
                        <input nz-input [(ngModel)]="saveObj.consumerRegistrationName" readonly />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="12">
                <nz-form-item>
                    <nz-form-label [nzSpan]="8">计费方式</nz-form-label>
                    <nz-form-control [nzSpan]="16">
                        <nz-select style="width: 100%;" [(ngModel)]="saveObj.feeMode" [nzDisabled]="disabled">
                            <nz-option nzLabel="登记计费" nzValue="1"> </nz-option>
                            <nz-option nzLabel="按月计费" nzValue="2"> </nz-option>
                            <nz-option nzLabel="按日计费" nzValue="3"> </nz-option>
                        </nz-select>
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="12" *ngIf="saveObj.feeMode=='1'">
                <nz-form-item>
                    <nz-form-label [nzSpan]="8">数量</nz-form-label>
                    <nz-form-control [nzSpan]="16">
                        <nz-input-number [(ngModel)]="saveObj.costQuantity" nzDisabled [nzMin]="1" [nzStep]="1" (ngModelChange)="blur()"></nz-input-number>
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="12">
                <nz-form-item>
                    <nz-form-label [nzSpan]="8">单价</nz-form-label>
                    <nz-form-control [nzSpan]="16">
                        <input nz-input maxlength="32" [(ngModel)]="saveObj.unitPrice" readonly />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="12">
                <nz-form-item>
                    <nz-form-label [nzSpan]="8">规格</nz-form-label>
                    <nz-form-control [nzSpan]="16">
                        <input nz-input maxlength="32" [(ngModel)]="saveObj.specs" readonly />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="12">
                <nz-form-item>
                    <nz-form-label [nzSpan]="8">抵扣券</nz-form-label>
                    <nz-form-control [nzSpan]="16">
                        <nz-select style="width: 100%;" [(ngModel)]="saveObj.couponD" [nzDisabled]="disabled" (ngModelChange)="changeDeductibleAmount()">
                            <nz-option *ngFor="let option of rebateList" [nzLabel]="option.rebate.voucherName" [nzValue]="option.id"> </nz-option>
                        </nz-select>
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="12">
                <nz-form-item>
                    <nz-form-label [nzSpan]="8">补价券</nz-form-label>
                    <nz-form-control [nzSpan]="16">
                        <nz-select style="width: 100%;" [(ngModel)]="saveObj.couponB" [nzDisabled]="disabled" (ngModelChange)="changeSupplementAmount()">
                            <nz-option *ngFor="let option of couponsList" [nzLabel]="option.supplementCoupons.supplementName" [nzValue]="option.id"> </nz-option>
                        </nz-select>
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="12">
                <nz-form-item>
                    <nz-form-label [nzSpan]="8">支付价格</nz-form-label>
                    <nz-form-control [nzSpan]="16">
                        <nz-input-number [(ngModel)]="saveObj.costMoney" nzDisabled [nzMin]="0" [nzStep]="1"></nz-input-number>
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="24">
                <nz-form-item>
                    <nz-form-label [nzSpan]="4"> 备注</nz-form-label>
                    <nz-form-control [nzSpan]="20">
                        <textarea rows="4" nz-input [(ngModel)]="saveObj.remark" [disabled]="disabled"></textarea>
                    </nz-form-control>
                </nz-form-item>
            </div>
        </div>
    </nz-card>
    <div style="text-align:center;margin-top: 30px;">
        <button class="saveBtn" nz-button nzType="primary" *ngIf="settlementStatus!='3'" nzSize="large" (click)="cancel()">
            取消结算
        </button>
    </div>
</nz-card>
